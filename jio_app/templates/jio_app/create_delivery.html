{% extends 'jio_app/base_admin.html' %}
{% load static %}

{% block title %}Crear Repartidor - JIO{% endblock %}

{% block content %}
<div class="panel-container">
    <div class="panel-header">
        <h1 class="panel-title">Crear repartidor</h1>
    </div>
    <form method="post" class="form-card" id="formCreateDelivery">
        {% csrf_token %}
        <div class="form-grid">
            <label>Nombre<input type="text" name="first_name" required></label>
            <label>Apellido<input type="text" name="last_name" required></label>
            <label>Email<input type="email" name="email" required></label>
            <label>Usuario<input type="text" name="username" required></label>
            <label>Contraseña<input type="password" name="password" required></label>
            <label>Teléfono<input type="text" name="telefono"></label>
            <label>Licencia<input type="text" name="licencia"></label>
            <label>Vehículo<input type="text" name="vehiculo"></label>
        </div>
        <div class="form-actions">
            <button class="btn btn-primary" type="submit">Crear</button>
            <a class="btn" href="{% url 'jio_app:admin_panel' %}">Cancelar</a>
        </div>
    </form>
    
</div>
{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{% static 'js/validaciones.js' %}"></script>
<script>
(function(){
  const form = document.getElementById('formCreateDelivery');
  if(!form) return;
  form.addEventListener('submit', function(e){
    const first = form.querySelector('input[name="first_name"]').value.trim();
    const last = form.querySelector('input[name="last_name"]').value.trim();
    const email = form.querySelector('input[name="email"]').value.trim();
    const username = form.querySelector('input[name="username"]').value.trim();
    const password = form.querySelector('input[name="password"]').value;
    const telefono = form.querySelector('input[name="telefono"]').value.trim();
    const licencia = form.querySelector('input[name="licencia"]').value.trim();
    const vehiculo = form.querySelector('input[name="vehiculo"]').value.trim();
    const ok = validarFormulario([
      ()=> validarNombre(first, 'nombre', 2, 30),
      ()=> validarNombre(last, 'apellido', 2, 30),
      ()=> validarEmail(email, 'email', 100),
      ()=> (function(){
            const errs = [];
            if(!/^[A-Za-z0-9._-]{3,30}$/.test(username)){
              errs.push('Usuario inválido. Use 3-30 caracteres: letras, números, . _ -');
            }
            return errs;
          })(),
      ()=> validarContrasena(password, 'contraseña', 8),
      ()=> (telefono ? validarTelefonoChileno(telefono, 'teléfono', false) : []),
      ()=> (licencia && licencia.length > 20 ? ['La licencia no puede exceder 20 caracteres.'] : []),
      ()=> (vehiculo && vehiculo.length > 100 ? ['El vehículo no puede exceder 100 caracteres.'] : [])
    ], 'Errores en creación de repartidor');
    if(!ok){ e.preventDefault(); }
  });
})();
</script>
{% endblock %}
{% endblock %}

